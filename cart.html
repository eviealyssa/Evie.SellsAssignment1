<!-- Displays all items in the cart -->
<!-- 
Evie Sells
Reg No. 21255921
Email: EASells@uclan.ac.uk 
-->


<!DOCTYPE html>
<html lang="en">

<head>
    <!-- link to the stylesheet -->
    <link rel="stylesheet" href="style.css" type= "text/css">
    <link rel="stylesheet" href="headFootStyle.css" type= "text/css">

    <!-- embed products array into file -->
    <script src="./resources/product-array.js"></script>

    <!-- setting up project -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Evie Sells - UCLan Shop - Cart</title>
</head>

<!-- when screen size is changed - function is called -->
<body onresize="changeFillerSize()">
    <header>
        <nav>
            <!-- navigation bar -->
            <div class="topNavBar">
                <!-- adding in logo -->
                <div class="logo">
                    <img src="resources/images/logo.svg" alt="UCLan logo" height="65rem" >
                </div>

                <!-- adding in hamburg menu icon for mobile users -->
                <a class="mobileMenuIcon splitNav" onclick="openHamburgerNav()"><img src="resources/images/other/hamburger-menu-icon.svg" alt="Menu" height="40px"></a>

                <!-- links for page navigation -->
                <li id="navLinks">
                    <a href="index.html" target="_self">Home</a>
                    <a href="products.html" target="_self" >Products</a>
                    <a href="cart.html" target="_self" id="cartText" class="activePage">Cart</a> <!-- id allows to hide/display cart text -->
                </li>

                <!-- cart menu icon for desktop / tablet -->
                <a href="cart.html" id="cartIcon" class="splitNav"><img src="resources/images/other/shopping-cart-image.svg" alt="Cart" height="40px"></a>
            </div>
        </nav>
    </header>

    <!-- Main -->
    <!-- Item container template -->
    <section id="itemCartContainer">
        <div class="itemCartCard">
            <img class="itemCartImage" src='' alt="Product Image" width="40%" onclick="viewItem(this)">
            <div class="itemCartInfo">
                <h2 class="itemCartName">name</h2>
                <h3 class="itemCartPrice">price</h3>
                <p class="itemCartColour">colour</p>
            </div>

            <div class="itemCartQuanity">
                <h2 class="itemCartQuantityText">Quantity</h2>
                <h2 class="itemCartQuantityInfo">amount</h2>

                <div class="quantityBtns">
                    <button class="quantBtn" onclick="increaseQuantity(this)">+</button>
                    <button class="quantBtn" onclick="decreaseQuantity(this)">-</button>
                </div>
            </div>
        </div>
    </section>

    <!-- displays the total of the basket -->
    <div id="totalDiv">
        <button id="totalPrice" onclick="payForCart()">Total: ££££</button>
    </div>

    <!-- displays if teh bag is empty -->
    <div id="bagEmpty">
        <h1>Bag is empty</h1>
        <button id="bagEmptyBtn" onclick="openProductsPage()">Start Shopping</button>
    </div>

    <div id="fillerBox"></div>


    <!-- Footer -->
    <footer>
        <div class="contactInfo">
            <h2>Contact Info:</h2>
            <p>Name: Evie Sells</p>
            <p>Email: <a id="emailAddress" href="mailto:EASells@uclan.ac.uk">EASells@uclan.ac.uk</a></p>
            <p>Reg.No: 21255921</p>
        </div>

        <div class="assignmentDetails">
            <h2>Details:</h2>
            <p>CO1707: Web Technologies</p>
            <p>Assignment 1: Web Application</p>
        </div>

        <div class="FindSU">
            <h2>Find the SU:</h2>
            <p>University of Central Lancashire Students' Union,</p>
            <p>Fylde Road, Preston. PR1 7BY</p>
        </div>

        <div class="socialMediaIcons">
            <h2>Stay in touch with the SU!</h2>

            <div class="iconsFooter">
                <a href="https://www.facebook.com/uclanstudentsunion/">
                    <img src='resources/images/social media icons/facebook-social-media-icon.svg' alt="Facebook icon" height="40">
                </a>
    
                <a href="https://www.tiktok.com/@uclansu">
                    <img src='resources/images/social media icons/tiktok-social-media-icon.svg' alt="TikTok icon" height="40">
                </a>
    
                <a href="https://www.instagram.com/uclansu/">
                    <img src='resources/images/social media icons/instagram-social-media-icon.svg' alt="Instagram icon" height="40">
                </a>
    
                <a href="https://x.com/i/flow/login?redirect_after_login=%2FUCLanSU">
                    <img src='resources/images/social media icons/x-social-media-black-icon.svg' alt="X icon" height="40">
                </a>
            </div>
        </div>
    </footer>

    <script>
         // Open / Close hamburger navigation function
         function openHamburgerNav()
        {
            // get navLink and set as linksNav
            var linksNav = document.getElementById("navLinks");
            // If nav shown, hide
            if (linksNav.style.display === "inline-table") {
                linksNav.style.display = "none";
            } 
            // If nav hidden, show
            else {
                linksNav.style.display = "inline-table";
            }
        }

        function addItemDetailsToCartPage(shoppingCart)
        {
            const itemCartList = document.getElementById('itemCartContainer');
            const itemCartCard = document.querySelector(".itemCartCard");

            var priceSum = 0;

            //find what type the ID is

            for (var i = 0; i < shoppingCart.length; i++)
            {
                var productArray;
                var productID = shoppingCart[i][0];
                var firstLetter = productID[0];
                if (firstLetter == 't')
                {
                    productArray = tshirts;
                }
                else if (firstLetter == 'h')
                {
                    productArray = hoodies;
                }
                else 
                {
                    productArray = jumpers;
                }

                //find the ID
                var dIndex = productID.indexOf("D");
                var length = productID.length;
                //get the ID by creating a substring
                var idNum = productID.substring(dIndex+1,length);

                //get the details of the id
                var itemDetails = productArray[idNum];

                let itemCartCardCopy = itemCartCard.cloneNode(true);
                itemCartList.appendChild(itemCartCardCopy);

                //set id
                itemCartCardCopy.id = productID;

                //populate id's with values
                itemCartCardCopy.querySelector('.itemCartName').innerHTML = itemDetails[0];
                itemCartCardCopy.querySelector('.itemCartColour').innerHTML = itemDetails[1];
                itemCartCardCopy.querySelector('.itemCartPrice').innerHTML = itemDetails[3];
                itemCartCardCopy.querySelector('.itemCartImage').src = "resources/" + itemDetails[4];
                itemCartCardCopy.querySelector('.itemCartQuantityInfo').innerHTML = shoppingCart[i][1];

                // add price to total price
                let itemPrice = itemDetails[3];

                // remove £ from start of price
                itemPrice = itemPrice.replace("£","");

                // convert string to a float, multiply by the quantity and add to previous value
                priceSum +=  parseFloat(itemPrice) * parseFloat(shoppingCart[i][1]);

                // make sure priceSum is 2 decimals
                priceSum = Math.round(priceSum * 100) / 100

                // add priceSum to display
                document.getElementById("totalPrice").innerHTML = "Pay Now: £" + priceSum;

            }

        }

        function getCartDetails()
        {
            var cartString = localStorage.getItem("shoppingBag");
            var cartList = [];
            var cartWord = '';

            var shoppingCart = [];

            //If there are already items in the cart
            if (cartString != null) //|| cartString != "" || cartString != ''
            {
                //separate string into a list
                for (var i=0; i < cartString.length; i++)
                {
                    //if letter/num - add to word
                    if (cartString[i] != ',')
                    {
                        cartWord = cartWord + cartString[i];
                    }
                    //add word to array and reset word
                    else {
                        if (cartWord != ''){
                            cartList.push(cartWord);
                            cartWord = '';
                        }
                        
                    }
                }

                // adds last item to cartList (or first if there was no comma)
                if (cartWord != ''){
                    cartList.push(cartWord);
                }

                // for each item in cartList -  add to 3d array
                for (var j=0; j < cartList.length; j++)
                {
                    // if empty - add straight away
                    if (shoppingCart == null)
                    {
                        shoppingCart.push([cartList[j],1]);
                    }
                    //if items in cart - search to see if cartList[j] is in there
                    else
                    {
                        var found = false;
                        for (let count = 0; count < shoppingCart.length; count ++)
                        {
                            if (shoppingCart[count][0] == cartList[j] )
                            {
                                //increase quantity
                                let temp = shoppingCart[count][1];
                                temp += 1;
                                shoppingCart[count][1] = temp;
                                found = true;
                            }
                        }

                        //if not found in cart - add
                        if (found == false)
                        {
                            shoppingCart.push([cartList[j],1]);
                        }
                    }
                }
                //adds info about items to page
                addItemDetailsToCartPage(shoppingCart);
            }
            //if cart is empty - show empty message
            else
            {
                isBagEmpty();
            }
        }

        function openProductsPage()
        {
            //sets scroll height to 0 -- for products page
            sessionStorage.setItem("scrollHeight", 0);
            // opens product page
            window.open('products.html', '_self');
        }

        function isBagEmpty()
        {
            var cartString = localStorage.getItem("shoppingBag");
            // if empty
            if (cartString == null || cartString == "")
            {
                document.getElementById("bagEmpty").style.display = "block";
                document.getElementById("totalDiv").style.display = "none";
            }
            // if not empty
            else
            {
                document.getElementById("bagEmpty").style.display = "none";
                document.getElementById("totalDiv").style.display = "block";
            }
        }

        function increaseQuantity(elm)
        {
            // get item cart card
            var itemCartCard = elm.parentNode.parentNode.parentNode;

            //get id of item cart card
            var itemCartCardID = itemCartCard.id;

            //add to cartList from storage
            var cartList = [];
            cartList = localStorage.getItem("shoppingBag");

            cartList = cartList + "," + itemCartCardID;
            localStorage.setItem("shoppingBag", cartList);

            // re-open cart page so value is changed
            window.open("cart.html", "_self");
        }

        function decreaseQuantity(elm)
        {
            // get item cart card
            var itemCartCard = elm.parentNode.parentNode.parentNode;

            //get id of item cart card
            var itemCartCardID = itemCartCard.id;

            // need to turn cartString (string) into a list (cartList)
            var cartString = localStorage.getItem("shoppingBag");
            var cartWord = '';
            var cartList = [];

            for (var i=0; i < cartString.length; i++)
            {
                //if letter/num - add to word
                if (cartString[i] != ',')
                {
                    cartWord = cartWord + cartString[i];
                }
                //add word to array and reset word
                else {
                    cartList.push(cartWord);
                    cartWord = '';
                }
            }

            // adds last item to cartList (or first if there was no comma)
            cartList.push(cartWord);

            // search cartList for ID
            var isFound = false;
            var firstIndex;

            for (var index = 0; index < cartList.length; index++)
            {
                if (cartList[index] == itemCartCardID &&  isFound == false)
                {
                    isFound = true;
                    firstIndex = index;
                }
            }

            // if not found - give error
            if (isFound == false)
            {
                alert("Error - item quantity could not be changed")
            }
            // if found - remove and reload page 
            else 
            {
                cartList.splice(firstIndex,1); //https://www.w3schools.com/jsref/jsref_splice.asp

                // set cartList in session storage
                localStorage.setItem("shoppingBag", cartList);
                // re-open cart page so value is changed
                window.open("cart.html", "_self");
            }
            
        }

        function viewItem(elm)
        {
            //gets the parent (productCard) of the button
            var parent = elm.parentNode;

            // gets the ID of the selected productCard
            var idProduct = parent.id;

            // sets item in session storage
            sessionStorage.setItem("itemToView", idProduct);

            //opens index page
            window.open(href="item.html", target="_self");
        }

        function payForCart()
        {
            // alert saying thanks for shopping
            alert("Thanks for your purchase! Payment has been collected from the registered card");

            // clear shopping cart
            localStorage.setItem("shoppingBag", "");

            // re-open cart page
            window.open(href="cart.html", target="_self");

        }
        
        function changeFillerSize()
        {
            var pageSize = window.innerHeight;
            var itemContainer = document.getElementById("itemCartContainer").offsetHeight;
            var bagText = document.getElementById('bagEmpty').offsetHeight;
            var totalDiv = document.getElementById('totalDiv').offsetHeight;

            var headHeight= 0;
            const headerHeight = document.getElementsByClassName("topNavBar");
            for (let i = 0; i < headerHeight.length; i++) {
                let temp = headerHeight[i].offsetHeight;
                headHeight = headHeight + temp;
            }

            var footerHeight = document.getElementsByTagName("footer")[0].offsetHeight;

            var toTake = footerHeight + headHeight + itemContainer + bagText + totalDiv;

            var fillerBoxSize = pageSize - toTake;

            if (toTake > 0){
                document.getElementById("fillerBox").style.height = fillerBoxSize + "px";
            }

        }
        // main
        isBagEmpty();
        getCartDetails();

        // hide item card template
        document.querySelector(".itemCartCard").style.display = "none";

        //ensures footer is always at the bottom of the page
        changeFillerSize();
        
    </script>


</body>